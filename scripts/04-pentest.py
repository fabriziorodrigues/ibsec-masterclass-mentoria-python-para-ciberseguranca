'''
Atenção, os códigos foram criados para fins educacionais e não devem ser utilizados para outros fins.
Esses código não são otimizados e portanto não devem ser utilizados em produção.
'''

from scapy.all import *
from scapy.layers.inet import IP, TCP

def scan_ip(ip, port_range):
    open_ports = []
    for port in range(*port_range):
        pkt = IP(dst=ip)/TCP(dport=port, flags="S")
        resp = sr1(pkt, timeout=2, verbose=0)

        if resp is None:
            continue

        if TCP in resp and resp[TCP].flags & 2:  # SYN-ACK flag
            open_ports.append(port)

            # Enviar pacote RST para fechar a conexão
            rst_pkt = IP(dst=ip)/TCP(dport=port, flags="R")
            send(rst_pkt, verbose=0)

    return open_ports

# Substitua '192.168.1.1' pelo IP que você deseja escanear
target_ip = "127.0.0.1"
# Defina a faixa de portas a serem escaneadas (por exemplo, de 1 a 1024)
port_range = (1, 1024)

print(f"Scanning IP: {target_ip}")
ports = scan_ip(target_ip, port_range)
print("Open ports:", ports)
